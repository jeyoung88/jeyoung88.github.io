<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="prefer-datetime-locale" content="en.js"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Swagger, Body Validator, Handlebar Compilation" /><meta property="og:locale" content="en" /><meta name="description" content="Step 3 Swagger API Nest.js has a fantastic Swagger integration. The code the instrument Swagger sub-system is as follows: ```typescript const swaggerConfig = new DocumentBuilder() .setTitle(‘ACME PDF Generator’) .setDescription(‘PDF Generator API documentation’) .setVersion(‘1.0’) .addTag(‘pdf’) .setContact(‘Justin Young’, ‘’, ‘young@acme.io’) .addServer(‘https://acme.com/api’) .build();" /><meta property="og:description" content="Step 3 Swagger API Nest.js has a fantastic Swagger integration. The code the instrument Swagger sub-system is as follows: ```typescript const swaggerConfig = new DocumentBuilder() .setTitle(‘ACME PDF Generator’) .setDescription(‘PDF Generator API documentation’) .setVersion(‘1.0’) .addTag(‘pdf’) .setContact(‘Justin Young’, ‘’, ‘young@acme.io’) .addServer(‘https://acme.com/api’) .build();" /><link rel="canonical" href="/posts/step-3-5/" /><meta property="og:url" content="/posts/step-3-5/" /><meta property="og:site_name" content="Justin’s" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-07-04T00:00:00-07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Swagger, Body Validator, Handlebar Compilation" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-07-21T01:31:59-07:00","datePublished":"2022-07-04T00:00:00-07:00","description":"Step 3 Swagger API Nest.js has a fantastic Swagger integration. The code the instrument Swagger sub-system is as follows: ```typescript const swaggerConfig = new DocumentBuilder() .setTitle(‘ACME PDF Generator’) .setDescription(‘PDF Generator API documentation’) .setVersion(‘1.0’) .addTag(‘pdf’) .setContact(‘Justin Young’, ‘’, ‘young@acme.io’) .addServer(‘https://acme.com/api’) .build();","headline":"Swagger, Body Validator, Handlebar Compilation","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/step-3-5/"},"url":"/posts/step-3-5/"}</script><title>Swagger, Body Validator, Handlebar Compilation | Justin's</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Justin's"><meta name="application-name" content="Justin's"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/images/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Justin's</a></div><div class="site-subtitle font-italic">A modern PDF service</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/jeyoung88" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['jeyoung88','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Swagger, Body Validator, Handlebar Compilation</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Swagger, Body Validator, Handlebar Compilation</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1656918000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 4, 2022 </em> </span> <span> Updated <em class="" data-ts="1658392319" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 21, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/jeyoung88">Justin Young</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="989 words"> <em>5 min</em> read</span></div></div></div><div class="post-content"><h2 id="step-3-swagger-api"><span class="mr-2">Step 3 Swagger API</span><a href="#step-3-swagger-api" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Nest.js has a fantastic Swagger integration. The code the instrument Swagger sub-system is as follows:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre> <span class="kd">const</span> <span class="nx">swaggerConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DocumentBuilder</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">setTitle</span><span class="p">(</span><span class="dl">'</span><span class="s1">ACME PDF Generator</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">setDescription</span><span class="p">(</span><span class="dl">'</span><span class="s1">PDF Generator API documentation</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">setVersion</span><span class="p">(</span><span class="dl">'</span><span class="s1">1.0</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">addTag</span><span class="p">(</span><span class="dl">'</span><span class="s1">pdf</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">setContact</span><span class="p">(</span><span class="dl">'</span><span class="s1">Justin Young</span><span class="dl">'</span><span class="p">,</span> <span class="dl">''</span><span class="p">,</span> <span class="dl">'</span><span class="s1">young@acme.io</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">addServer</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://acme.com/api</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">build</span><span class="p">();</span>

  <span class="kd">const</span> <span class="nb">document</span> <span class="o">=</span> <span class="nx">SwaggerModule</span><span class="p">.</span><span class="nx">createDocument</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">swaggerConfig</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">extraModels</span><span class="p">:</span> <span class="nx">ExtraModelList</span><span class="p">,</span>
  <span class="p">});</span>
  <span class="nx">SwaggerModule</span><span class="p">.</span><span class="nx">setup</span><span class="p">(</span><span class="dl">'</span><span class="s1">doc</span><span class="dl">'</span><span class="p">,</span> <span class="nx">app</span><span class="p">,</span> <span class="nb">document</span><span class="p">);</span>
</pre></table></code></div></div><p>The next step is to create DTO class that can model the input data. This step can be very tedious and they are done all through Nest/Swagger decorators. An example of the Sale Invoice V1 decorations is:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="p">@</span><span class="nd">ApiExtraModels</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">Sales_Invoice_V1</span> <span class="kd">extends</span> <span class="nx">BaseDataDto</span><span class="p">{</span>

  <span class="p">@</span><span class="nd">IsObject</span><span class="p">()</span>
  <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
  <span class="p">@</span><span class="nd">ValidateNested</span><span class="p">()</span>
  <span class="p">@</span><span class="nd">Type</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">CompanyDto</span><span class="p">)</span>
  <span class="p">@</span><span class="nd">ApiProperty</span><span class="p">({</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
  <span class="nx">company</span><span class="p">:</span> <span class="nx">CompanyDto</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">IsObject</span><span class="p">()</span>
  <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
  <span class="p">@</span><span class="nd">ValidateNested</span><span class="p">()</span>
  <span class="p">@</span><span class="nd">Type</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">RecipientDto</span><span class="p">)</span>
  <span class="p">@</span><span class="nd">ApiProperty</span><span class="p">({</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
  <span class="nx">recipient</span><span class="p">:</span> <span class="nx">RecipientDto</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">IsObject</span><span class="p">()</span>
  <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
  <span class="p">@</span><span class="nd">ValidateNested</span><span class="p">()</span>
  <span class="p">@</span><span class="nd">Type</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">PurchasedDto</span><span class="p">)</span>
  <span class="p">@</span><span class="nd">ApiProperty</span><span class="p">({</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
  <span class="nx">purchased</span><span class="p">:</span> <span class="nx">PurchasedDto</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">ApiProperty</span><span class="p">({</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span><span class="dl">'</span><span class="s1">string</span><span class="dl">'</span><span class="p">,</span> <span class="na">example</span><span class="p">:</span> <span class="dl">"</span><span class="s2">sales-invoice-v1</span><span class="dl">"</span> <span class="p">})</span>
  <span class="p">@</span><span class="nd">IsString</span><span class="p">()</span>
  <span class="nx">kind</span><span class="p">:</span> <span class="dl">"</span><span class="s2">sales-invoice-v1</span><span class="dl">"</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Last you need to put the Swagger decorators at the PDF Controller (introduce in step 7).</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>  <span class="p">@</span><span class="nd">ApiCreatedResponse</span><span class="p">({</span> <span class="na">description</span><span class="p">:</span> <span class="dl">"</span><span class="s2">PDF file has been generated</span><span class="dl">"</span> <span class="p">})</span>
  <span class="p">@</span><span class="nd">ApiHeaders</span><span class="p">(</span><span class="nx">API_HEADERS</span><span class="p">)</span>
  <span class="p">@</span><span class="nd">ApiBody</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="nx">RootDataDto</span> <span class="p">})</span>
</pre></table></code></div></div><p>A word of warning. Since the input in POST Body is normally composed of actually data extracted from legacy system , the structure can change quite frequently and it can be complex. Writing a accurate Swagger API that depicts the input format can be very tedious and perhaps impractical. But if the input data is relatives stable, the Swagger documentation can be very helpful to callers of the PDF Generator.</p><hr /><h2 id="step-4-body-validator"><span class="mr-2">Step 4 Body Validator</span><a href="#step-4-body-validator" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>If one wants to take one step further, such as validating the structure of the input data before it goes further into the rendering pipeline, a JSON tree validator can be instrumented using <em>class-validator</em> package https://www.npmjs.com/package/class-validator. Refer to the typescript DTO class above. The use of validation decorators (below) will serve the purpose of scaffolding the validation mechanism.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">IsNumber</span><span class="p">,</span> <span class="nx">IsNotEmpty</span><span class="p">,</span> <span class="nx">IsString</span><span class="p">,</span> <span class="nx">ValidateNested</span><span class="p">,</span> <span class="nx">IsCurrency</span><span class="p">,</span> <span class="nx">IsInt</span><span class="p">,</span> <span class="nx">IsObject</span><span class="p">,</span> <span class="nx">IsArray</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">class-validator</span><span class="dl">'</span><span class="p">;</span>
</pre></table></code></div></div><p>Same word of warning also that maintaining a tight validation on input JSON composed from legacy systems that can changed can be very time consuming.</p><hr /><h2 id="step-5-handlebars-compilation"><span class="mr-2">Step 5 Handlebars Compilation</span><a href="#step-5-handlebars-compilation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The core PDF system use advanced <strong>Handlebars</strong> template mechanism to fuse input data into template code. Please read up the documentation https://handlebarsjs.com</p><p>There are two approaches to instrument <strong>Handlebars</strong> sub-system. I have done integrating the entire compilation process the Node’s engine mechanism, the other is a straight reading <em>*.hbs</em> files from designated directories and compile them. I’ve taken the later. I created a Handlebars services where I can pre-compile all *.hbs files at startup :</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">HbsService</span> <span class="p">{</span>

    <span class="c1">//call each request</span>
    <span class="k">async</span> <span class="nx">compileToHTML</span><span class="p">(</span><span class="nx">hbs</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">await</span> <span class="nx">HbsCore</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">hbs</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">//call once at system startup</span>
    <span class="nx">preCompileHbs</span><span class="p">(</span><span class="nx">dir</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">HbsCore</span><span class="p">.</span><span class="nx">registerPartial</span><span class="p">(</span><span class="nx">dir</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">//call once at system startup</span>
    <span class="nx">registerHelper</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>

    <span class="p">...</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The goal of the HbsService is to pre-compile all the *.hbs files, register all the system reusable helper functions , and compile a final HTML file when the data arrives for each document.</p><p>There are two places where helper functions are defined , one is the system helper functions reusable for every documents (loaded first at startup) and the other is document specific ones (load later at Interceptor activation). Thus, we have to make sure the document specific helper function names do not override the system ones already loaded.</p><hr /><h2 id="handlebars-helper-functions"><span class="mr-2">Handlebars Helper Functions</span><a href="#handlebars-helper-functions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The Helper Functions are critical to the template system. There are plenty of third party libraries you can acquire to use. I have accumulated a list of shareable ones, note I used a convention to name Helper Functions starting with _xx.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">const</span> <span class="nx">helpers</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">_t</span><span class="p">:</span> <span class="nx">_t</span><span class="p">,</span>
  <span class="na">_t_B</span><span class="p">:</span> <span class="nx">_t_B</span><span class="p">,</span>
  <span class="na">_tn</span><span class="p">:</span> <span class="nx">_tn</span><span class="p">,</span>
  <span class="na">_assign</span><span class="p">:</span> <span class="nx">_assign</span><span class="p">,</span>
  <span class="nx">_</span><span class="na">$</span><span class="p">:</span> <span class="nx">_$</span><span class="p">,</span>
  <span class="nx">_</span><span class="na">$_B</span><span class="p">:</span> <span class="nx">_$_B</span><span class="p">,</span>
  <span class="na">_n</span><span class="p">:</span> <span class="nx">_n</span><span class="p">,</span>
  <span class="na">_n_B</span><span class="p">:</span> <span class="nx">_n_B</span><span class="p">,</span>
  <span class="na">_dt</span><span class="p">:</span> <span class="nx">_dt</span><span class="p">,</span>
  <span class="na">_dt_B</span><span class="p">:</span> <span class="nx">_dt_B</span><span class="p">,</span>
  <span class="na">_p</span><span class="p">:</span> <span class="nx">_p</span><span class="p">,</span>
  <span class="na">_select</span><span class="p">:</span> <span class="nx">_select</span><span class="p">,</span>
  <span class="na">_foreach</span><span class="p">:</span> <span class="nx">_foreach</span><span class="p">,</span>
  <span class="na">_count</span><span class="p">:</span> <span class="nx">_count</span><span class="p">,</span>
  <span class="na">_config</span><span class="p">:</span> <span class="nx">_config</span><span class="p">,</span>
  <span class="na">_stringfy</span><span class="p">:</span> <span class="nx">_stringfy</span><span class="p">,</span>
  <span class="na">_sumArray</span><span class="p">:</span> <span class="nx">_sumArray</span><span class="p">,</span>
  <span class="na">_sum</span><span class="p">:</span> <span class="nx">_sum</span><span class="p">,</span>
  <span class="na">_average</span><span class="p">:</span> <span class="nx">_average</span><span class="p">,</span>
  <span class="na">_op</span><span class="p">:</span> <span class="nx">_op</span><span class="p">,</span>
  <span class="na">_round</span><span class="p">:</span> <span class="nx">_round</span><span class="p">,</span>
  <span class="na">_floor</span><span class="p">:</span> <span class="nx">_floor</span><span class="p">,</span>
  <span class="na">_ceil</span><span class="p">:</span> <span class="nx">_ceil</span><span class="p">,</span>
  <span class="na">_abs</span><span class="p">:</span> <span class="nx">_abs</span><span class="p">,</span>
  <span class="na">_compare</span><span class="p">:</span> <span class="nx">_compare</span><span class="p">,</span>
  <span class="na">_and</span><span class="p">:</span> <span class="nx">_and</span><span class="p">,</span>
  <span class="na">_or</span><span class="p">:</span> <span class="nx">_or</span><span class="p">,</span>
  <span class="na">_not</span><span class="p">:</span> <span class="nx">_not</span><span class="p">,</span>
  <span class="na">_neither</span><span class="p">:</span> <span class="nx">_neither</span><span class="p">,</span>
  <span class="na">_eq</span><span class="p">:</span> <span class="nx">_eq</span><span class="p">,</span>
  <span class="na">_ne</span><span class="p">:</span> <span class="nx">_ne</span><span class="p">,</span>
  <span class="na">_lt</span><span class="p">:</span> <span class="nx">_lt</span><span class="p">,</span>
  <span class="na">_lte</span><span class="p">:</span> <span class="nx">_lte</span><span class="p">,</span>
  <span class="na">_gte</span><span class="p">:</span> <span class="nx">_gte</span><span class="p">,</span>
  <span class="na">_gt</span><span class="p">:</span> <span class="nx">_gt</span><span class="p">,</span>
  <span class="na">_if</span><span class="p">:</span> <span class="nx">_if</span>
<span class="p">};</span>

</pre></table></code></div></div><p>There are two types of Helper Functions: expression and block . An example of the expression type is:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kd">function</span> <span class="nx">_average</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
  <span class="c1">// const options = arguments[len];</span>
  <span class="kd">let</span> <span class="nx">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">e</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">sum</span> <span class="o">+=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
      <span class="nx">count</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">sum</span> <span class="o">/</span> <span class="nx">count</span><span class="p">;</span>
<span class="p">};</span>
</pre></table></code></div></div><p>Where _average is used inside a *.hbs file , where arrayNum is an array of number pass into the Handlebars sub-system from the HTTP POST dataset.</p><div class="language-hbs highlighter-rouge"><div class="code-header"> <span data-label-text="Hbs"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;div&gt;</span> <span class="k">{{</span><span class="nv">_average</span> <span class="nv">arrayNum</span><span class="k">}}</span> <span class="nt">&lt;/div&gt;</span>
</pre></table></code></div></div><hr /><p>An example of the block Helper Function:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kd">function</span> <span class="nx">_count</span><span class="p">(</span><span class="nx">size</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">options</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">check</span><span class="p">(</span><span class="dl">"</span><span class="s2">_count</span><span class="dl">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">createFrame</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
  <span class="kd">let</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">size</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="p">{</span> <span class="na">index</span><span class="p">:</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="na">total</span><span class="p">:</span> <span class="nx">size</span><span class="p">,</span> <span class="na">isFirst</span><span class="p">:</span> <span class="nx">i</span> <span class="o">===</span> <span class="mi">0</span><span class="p">,</span> <span class="na">isLast</span><span class="p">:</span> <span class="nx">i</span> <span class="o">===</span> <span class="p">(</span><span class="nx">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">};</span>
    <span class="nx">data</span><span class="p">.</span><span class="nx">index</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span>
    <span class="nx">buffer</span> <span class="o">+=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">fn</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="p">{</span> <span class="na">data</span><span class="p">:</span> <span class="nx">data</span> <span class="p">});</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">buffer</span><span class="p">;</span>
<span class="p">};</span>
</pre></table></code></div></div><p>Where _count is used inside a *.hbs file</p><div class="language-hbs highlighter-rouge"><div class="code-header"> <span data-label-text="Hbs"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nt">&lt;div&gt;</span>
    <span class="k">{{#</span><span class="nn">_count</span> <span class="nv">4</span><span class="k">}}</span>
        <span class="nt">&lt;div&gt;</span><span class="k">{{</span><span class="nv">this</span><span class="p">.</span><span class="nv">index</span><span class="k">}}</span>/<span class="k">{{</span><span class="nv">this</span><span class="p">.</span><span class="nv">total</span><span class="k">}}</span><span class="nt">&lt;/div&gt;</span>
    <span class="k">{{/</span><span class="nn">_count</span><span class="k">}}</span>
<span class="nt">&lt;/div&gt;</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/pdf-service/'>pdf-service</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/swagger/" class="post-tag no-text-decoration" >swagger</a> <a href="/tags/body-validator/" class="post-tag no-text-decoration" >body-validator</a> <a href="/tags/handlebar-compilation/" class="post-tag no-text-decoration" >handlebar-compilation</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Swagger%2C+Body+Validator%2C+Handlebar+Compilation+-+Justin%27s&url=%2Fposts%2Fstep-3-5%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Swagger%2C+Body+Validator%2C+Handlebar+Compilation+-+Justin%27s&u=%2Fposts%2Fstep-3-5%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Fstep-3-5%2F&text=Swagger%2C+Body+Validator%2C+Handlebar+Compilation+-+Justin%27s" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/step-1-2/">JWT/Header Guard, Interceptor</a><li><a href="/posts/step-6-9/">Controller, Browser Page Pool, Puppeteer , Exception Filter</a><li><a href="/posts/architecture/">Architecture of PDF generator</a><li><a href="/posts/step-3-5/">Swagger, Body Validator, Handlebar Compilation</a><li><a href="/posts/i18n/">Localization, PDF-Footer</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/handlebars/">handlebars</a> <a class="post-tag" href="/tags/node/">node</a> <a class="post-tag" href="/tags/puppeteer/">puppeteer</a> <a class="post-tag" href="/tags/architecture/">architecture</a> <a class="post-tag" href="/tags/async/">async</a> <a class="post-tag" href="/tags/body-validator/">body-validator</a> <a class="post-tag" href="/tags/browser-page-pool/">browser-page-pool</a> <a class="post-tag" href="/tags/database-driver/">database-driver</a> <a class="post-tag" href="/tags/deployment/">deployment</a> <a class="post-tag" href="/tags/docker/">docker</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/intro/"><div class="card-body"> <em class="small" data-ts="1656658800" data-df="ll" > Jul 1, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Introduction PDF Service</h3><div class="text-muted small"><p> Welcome to my advanced Node journey Many asked me what is the big deal of a modern PDF generator service; they exist for a long time and is a commodity. Many companies use lower level native PDF l...</p></div></div></a></div><div class="card"> <a href="/posts/architecture/"><div class="card-body"> <em class="small" data-ts="1656745200" data-df="ll" > Jul 2, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Architecture of PDF generator</h3><div class="text-muted small"><p> Diagram Node vs Nest vs Micro-Service (#10) Nest.js is a wonderful backend library layered on top of Node. Nest.js is modeled after Angular’s constructs and use of decorators but applied at th...</p></div></div></a></div><div class="card"> <a href="/posts/step-1-2/"><div class="card-body"> <em class="small" data-ts="1656831600" data-df="ll" > Jul 3, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>JWT/Header Guard, Interceptor</h3><div class="text-muted small"><p> Step 1a JWT Guard Guard is the first step in the pipeline of the HTTP POST that will be activated . It can be applied at the Controller level such as @UseGuards(JwtAuthGuard) and @UseGuards(HeaderG...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/step-1-2/" class="btn btn-outline-primary" prompt="Older"><p>JWT/Header Guard, Interceptor</p></a> <a href="/posts/step-6-9/" class="btn btn-outline-primary" prompt="Newer"><p>Controller, Browser Page Pool, Puppeteer , Exception Filter</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/jeyoung88">Justin Young</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are copyrighted by the author.">All rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Dream Big</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/handlebars/">handlebars</a> <a class="post-tag" href="/tags/node/">node</a> <a class="post-tag" href="/tags/puppeteer/">puppeteer</a> <a class="post-tag" href="/tags/architecture/">architecture</a> <a class="post-tag" href="/tags/async/">async</a> <a class="post-tag" href="/tags/body-validator/">body-validator</a> <a class="post-tag" href="/tags/browser-page-pool/">browser-page-pool</a> <a class="post-tag" href="/tags/database-driver/">database-driver</a> <a class="post-tag" href="/tags/deployment/">deployment</a> <a class="post-tag" href="/tags/docker/">docker</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.js.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
